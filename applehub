

-- UI Library & Managers
local Library = loadstring(game:HttpGet("https://github.com/ActualMasterOogway/Fluent-Renewed/releases/latest/download/Fluent.luau"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/Krishna07-kkr/remotesavemanager/refs/heads/main/savemanager"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/InterfaceManager.luau"))()

-- ===========================
-- EGG DATA & FUNCTIONS
-- ===========================

local extraEggNames = {}

-- Stats Variables
local eggsHatched = 0
local hatchStartTime = 0
local isHatching = false

-- Function to scan workspace for available Eggs (Includes worlds with numbers)
local function getEggNames()
    local eggNamesSet = {}
    local zones = workspace:FindFirstChild("Zones")

    if zones then
        for _, world in pairs(zones:GetChildren()) do

            -- Skip AdminEvent
            if world.Name == "AdminEvent" then
                continue
            end

            -- Look at ALL Folders (No number check)
            if world:IsA("Folder") then

                local eggsFolder
                local interactables = world:FindFirstChild("Interactables")

                if interactables and interactables:FindFirstChild("Eggs") then
                    eggsFolder = interactables.Eggs
                elseif world:FindFirstChild("Eggs") then
                    eggsFolder = world.Eggs
                end

                if eggsFolder then
                    for _, egg in ipairs(eggsFolder:GetChildren()) do
                        if not egg.Name:lower():find("rewind") then
                            local name = egg.Name
                            name = name:gsub("%s*[Ee][Gg][Gg]%s*$", "")
                            name = name:match("^%s*(.-)%s*$")

                            -- Fix specific name if needed
                            if name == "IceSpiked" then
                                name = "IceSpikes"
                            end

                            eggNamesSet[name] = true
                        end
                    end
                end
            end
        end
    end

    for _, extraName in ipairs(extraEggNames) do
        eggNamesSet[extraName] = true
    end

    local eggNames = {}
    for name in pairs(eggNamesSet) do
        table.insert(eggNames, name)
    end
    table.sort(eggNames)

    return eggNames
end

-- ===========================
-- WINDOW SETUP
-- ===========================

local Window = Library:Window{
    Title = "aws",
    SubTitle = "By tradesland",
    TabWidth = 160,
    Size =  UDim2.fromOffset(580, 460),
    Resize = false, 
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftShift
}

-- Define Tabs (From Boss Script - The "Old Interface")
local Tabs = {
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" }),
    AutoFight = Window:AddTab({ Title = "boss", Icon = "crown" }),
    Eggs = Window:AddTab({ Title = "Eggs", Icon = "egg" }),
}

-- ===========================
-- BOSS FIGHT SECTION
-- ===========================

local FightSection = Tabs.AutoFight:AddSection("Auto Fight")

local npcLocations = {}

-- 1. Add Special Event Zones Manually
if workspace.GameObjects.ArmWrestling:FindFirstChild("ToyFactory") then
    npcLocations["ToyFactory"] = workspace.GameObjects.ArmWrestling.ToyFactory.NPC
end
if workspace.GameObjects.ArmWrestling:FindFirstChild("NorthPole") then
    npcLocations["NorthPole"] = workspace.GameObjects.ArmWrestling.NorthPole.NPC
end

-- 2. Auto-Loop for Worlds 1 to 22
for i = 1, 22 do
    local worldNum = tostring(i)
    local worldFolder = workspace.GameObjects.ArmWrestling:FindFirstChild(worldNum)
    
    if worldFolder then
        local npcFolder = worldFolder:FindFirstChild("npc") or worldFolder:FindFirstChild("NPC")
        if npcFolder then
            npcLocations[worldNum] = npcFolder
        end
    end
end

local modelNames = {}

for _, path in pairs(npcLocations) do
    if path then
        for _, npc in pairs(path:GetChildren()) do
            if npc:IsA("Model") then
                table.insert(modelNames, npc.Name)
            end
        end
    end
end

table.sort(modelNames)

local modelDropdown = Tabs.AutoFight:AddDropdown("ModelDropdown", {
    Title = "Select Boss",
    Values = modelNames,
    Multi = false,
    Searchable = true,
    Default = modelNames[1] or "",
})

local AutoClickToggle = Tabs.AutoFight:AddToggle("AutoClick", {
    Title = "Auto Click/Crit",
    Description = "Supports the Instant Win hack.",
    Default = false
})

local AutoFightToggle = Tabs.AutoFight:AddToggle("AutoFight", {
    Title = "Auto Fight (Instant Win)",
    Description = "Automatically starts fights and applies instant win hacks.",
    Default = false
})

pcall(function()
    local gameAnalyticsError = game:GetService("ReplicatedStorage"):FindFirstChild("GameAnalyticsError")
    if gameAnalyticsError then
        gameAnalyticsError.FireServer = function(self, ...) return end
    end
end)

local AlwaysWin = Tabs.AutoFight:AddButton({
    Title = "Force Instant Win (Manual)",
    Description = "If Auto Fight isn't fast enough, click this.",
    Callback = function()
        coroutine.resume(coroutine.create(function()
            local armWrestle = require(game:GetService("ReplicatedStorage").Controllers.Fighting.ArmWrestleController)
            local originalIncrementPower = armWrestle.IncrementPower
            armWrestle.IncrementPower = function(self, amount)
                originalIncrementPower(self, math.huge) 
            end
            spawn(function()
                while armWrestle.Fighting do
                    if armWrestle.Health and armWrestle.MaxHealth then armWrestle.Health = armWrestle.MaxHealth end
                    task.wait(0.01)
                end
            end)
            local originalUpdateFight = armWrestle.UpdateFight
            armwrestle.UpdateFight = function(self) end
        end))
    end
})

-- Boss Services & Variables
local KnitServices = game:GetService("ReplicatedStorage").Packages.Knit.Services
local ArmwrestleServiceRF = KnitServices:WaitForChild("ArmWrestleService"):WaitForChild("RF")
local ZoneService = KnitServices:WaitForChild("ZoneService"):WaitForChild("RE")

local autoClickThreads = {}
local autoFightThreads = {}
local cleanupConnections = {}
local lastZoneCheck = 0
local hacksApplied = false

local function applyInstantWinHacks()
    if hacksApplied then return end
    hacksApplied = true
    
    pcall(function()
        local armWrestle = require(game:GetService("ReplicatedStorage").Controllers.Fighting.ArmWrestleController)
        
        local originalIncrementPower = armWrestle.IncrementPower
        armWrestle.IncrementPower = function(self, amount)
            originalIncrementPower(self, math.huge) 
        end
        
        spawn(function()
            while true do
                if armWrestle.Fighting then
                    if armWrestle.Health and armWrestle.MaxHealth then
                        armWrestle.Health = armWrestle.MaxHealth
                    end
                end
                task.wait(0.01)
            end
        end)
        
        local originalUpdateFight = armWrestle.UpdateFight
        armWrestle.UpdateFight = function(self) end
    end)
end

local function teleportToNpcZone(npcName)
    local player = game.Players.LocalPlayer
    local playerCurrentZone = player:GetAttribute("CurrentZone")
    
    local npcZone = nil
    for zoneName, path in pairs(npcLocations) do
        if path:FindFirstChild(npcName) then
            npcZone = zoneName
            break
        end
    end
    
    if npcZone and playerCurrentZone ~= npcZone then
        local teleportDest = workspace.Zones:FindFirstChild(npcZone)
        
        if teleportDest then
            local spawnLoc = teleportDest:FindFirstChild("Interactables")
            if spawnLoc then
                spawnLoc = spawnLoc:FindFirstChild("Teleports")
                if spawnLoc then
                    spawnLoc = spawnLoc:FindFirstChild("Locations")
                    if spawnLoc then
                        spawnLoc = spawnLoc:FindFirstChild("Spawn")
                    end
                end
            end

            if spawnLoc then
                local args = { [1] = spawnLoc }
                ZoneService.teleport:FireServer(unpack(args))
                task.wait(0.1) 
                return true
            end
        end
    end
    return npcZone ~= nil
end

local function cleanupRequests()
    collectgarbage("count")
    pcall(function() local temp = ArmwrestleServiceRF task.wait(0.01) end)
end

AutoClickToggle:OnChanged(function()
    if AutoClickToggle.Value then
        for _, thread in pairs(autoClickThreads) do
            if typeof(thread) == "thread" then task.cancel(thread) elseif typeof(thread) == "table" then thread.active = false end
        end
        autoClickThreads = {}
        
        if cleanupConnections.autoClick then cleanupConnections.autoClick:Disconnect() end
        
        task.spawn(function()
            for i = 1, 500 do
                local threadData = { active = true }
                table.insert(autoClickThreads, threadData)
                task.spawn(function()
                    while threadData.active and AutoClickToggle.Value do
                        pcall(function()
                            ArmwrestleServiceRF:WaitForChild("RequestClick"):InvokeServer()
                            ArmwrestleServiceRF:WaitForChild("RequestCritHit"):InvokeServer()
                        end)
                        task.wait()
                    end
                end)
                task.wait(0.001) 
            end
        end)
        
        cleanupConnections.autoClick = task.spawn(function()
            while AutoClickToggle.Value do
                task.wait(5) 
                if AutoClickToggle.Value then cleanupRequests() end
            end
        end)
    else
        for _, thread in pairs(autoClickThreads) do
            if typeof(thread) == "thread" then task.cancel(thread) elseif typeof(thread) == "table" then thread.active = false end
        end
        autoClickThreads = {}
        if cleanupConnections.autoClick then task.cancel(cleanupConnections.autoClick) cleanupConnections.autoClick = nil end
        cleanupRequests()
    end
end)

AutoFightToggle:OnChanged(function()
    if AutoFightToggle.Value then
        applyInstantWinHacks()
        
        local selectedName = modelDropdown.Value
        teleportToNpcZone(selectedName)
        
        for _, flag in pairs(autoFightThreads) do flag.active = false end
        autoFightThreads = {}
        
        if cleanupConnections.autoFight then cleanupConnections.autoFight:Disconnect() end
        
        for i = 1, 500 do
            local threadFlag = { active = true }
            table.insert(autoFightThreads, threadFlag)
            
            task.spawn(function()
                while threadFlag.active and AutoFightToggle.Value do
                    local selectedName = modelDropdown.Value
                    if selectedName then
                        local currentTime = tick()
                        if currentTime - lastZoneCheck > 2 then 
                            teleportToNpcZone(selectedName)
                            lastZoneCheck = currentTime
                        end
                        
                        local args = { [1] = selectedName }
                        pcall(function()
                            ArmwrestleServiceRF:WaitForChild("RequestStartFight"):InvokeServer(unpack(args))
                        end)
                    end
                    task.wait(0.01)
                end
            end)
            task.wait(0.001) 
        end
        
        cleanupConnections.autoFight = task.spawn(function()
            while AutoFightToggle.Value do
                task.wait(5) 
                if AutoFightToggle.Value then cleanupRequests() end
            end
        end)
    else
        for _, flag in pairs(autoFightThreads) do flag.active = false end
        autoFightThreads = {}
        if cleanupConnections.autoFight then task.cancel(cleanupConnections.autoFight) cleanupConnections.autoFight = nil end
        cleanupRequests()
    end
end)

modelDropdown:OnChanged(function()
    if AutoFightToggle.Value then
        local selectedName = modelDropdown.Value
        teleportToNpcZone(selectedName)
        lastZoneCheck = tick()
    end
end)

-- ===========================
-- EGG SECTION (Merged)
-- ===========================

local EggSection = Tabs.Eggs:AddSection("Eggs")

-- Hatch Amount Dropdown
local HatchAmountDropdown = Tabs.Eggs:AddDropdown("HatchAmount", {
    Title = "Hatch Amount",
    Values = {"1x", "3x", "8x", "30x", "Max"},
    Multi = false,
    Searchable = true,
    Default = "1x"
})

-- Egg Selection Dropdown (Populated Dynamically)
local eggNames = getEggNames()
local EggDropdown = Tabs.Eggs:AddDropdown("EggSelect", {
    Title = "Select Egg",
    Values = eggNames,
    Multi = false,
    Searchable = true,
    Default = eggNames[1] or "None"
})

-- Speed Display UI
local SpeedDisplay = EggSection:Paragraph("SpeedDisplay", {
    Title = "Hatch Stats",
    Content = "Speed: 0.00 Eggs/s\nTotal: 0"
})

-- Background Loop to Update Speed
spawn(function()
    while true do
        wait(0.5)
        if isHatching and hatchStartTime > 0 then
            local elapsed = tick() - hatchStartTime
            local speed = (eggsHatched / elapsed)
            SpeedDisplay:SetValue(string.format("Speed: %.2f Eggs/s\nTotal: %d", speed, eggsHatched))
        else
             SpeedDisplay:SetValue(string.format("Speed: 0.00 Eggs/s\nTotal: %d", eggsHatched))
        end
    end
end)

-- Auto Hatch Toggle (Accurate Counting)
local AutoHatchToggle = Tabs.Eggs:AddToggle("AutoHatch", {
    Title = "Auto Hatch (Accurate)",
    Default = false
})

AutoHatchToggle:OnChanged(function()
    if AutoHatchToggle.Value then
        isHatching = true
        eggsHatched = 0
        hatchStartTime = tick()
        
        spawn(function()
            while AutoHatchToggle.Value do
                local selectedEgg = EggDropdown.Value
                local hatchMultiplier = HatchAmountDropdown.Value

                local args = {}

                -- Determine arguments
                if hatchMultiplier == "1x" then
                    args = {selectedEgg, nil, nil, false, nil}
                elseif hatchMultiplier == "3x" then
                    args = {selectedEgg, nil, true, false}
                elseif hatchMultiplier == "8x" then
                    args = {selectedEgg, nil, false, true, true}
                elseif hatchMultiplier == "30x" or hatchMultiplier == "Max" then
                    args = {selectedEgg, nil, nil, false, nil, true}
                end

                -- Invoke server using the KnitServices variable defined in Boss section
                local success, result = pcall(function()
                    return KnitServices.EggService.RF.purchaseEgg:InvokeServer(unpack(args))
                end)

                if success and result then
                    if type(result) == "table" then
                        eggsHatched = eggsHatched + #result
                    elseif result == true then
                        local batchSize = 1
                        if hatchMultiplier == "3x" then batchSize = 3
                        elseif hatchMultiplier == "8x" then batchSize = 8
                        elseif hatchMultiplier == "30x" or hatchMultiplier == "Max" then batchSize = 30
                        end
                        eggsHatched = eggsHatched + batchSize
                    end
                else
                    task.wait(0.1) 
                end
            end
        end)
    else
        isHatching = false
    end
end)

-- ===========================
-- SAVE MANAGER & INIT
-- ===========================

local function aggressiveCleanup()
    pcall(function() local oldService = ArmwrestleServiceRF ArmwrestleServiceRF = KnitServices:WaitForChild("ArmWrestleService"):WaitForChild("RF") end)
    collectgarbage("count") task.wait(0.1)
end

SaveManager:SetLibrary(Library)
InterfaceManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes{}
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)
Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()
